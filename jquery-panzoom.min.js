/*
 * jQuery PanZoom Plugin
 * Pan and zoom an image within a parent div.
 *
 * version: 0.10.0
 * @requires jQuery v1.4.2 or later (earlier probably work, but untested so far)
 *
 * Copyright (c) 2011 Ben Lumley
 * Examples and documentation at: https://github.com/benlumley/jQuery-PanZoom
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
*/
!function(t){function o(){eventData={target:this};var o=this.data("panZoom");c.zoomIn&&(c.zoomIn.bind("mousedown.panZoom",eventData,function(t){t.preventDefault(),t.data.target.panZoom("mouseDown","zoomIn")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(t){t.preventDefault(),t.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(t){t.preventDefault()}),o.bound_elements=o.bound_elements.add(c.zoomIn)),c.zoomOut&&(c.zoomOut.bind("mousedown.panZoom",eventData,function(t){t.preventDefault(),t.data.target.panZoom("mouseDown","zoomOut")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(t){t.preventDefault(),t.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(t){t.preventDefault()}),o.bound_elements=o.bound_elements.add(c.zoomOut)),c.panUp&&(c.panUp.bind("mousedown.panZoom",eventData,function(t){t.preventDefault(),t.data.target.panZoom("mouseDown","panUp")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(t){t.preventDefault(),t.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(t){t.preventDefault()}),o.bound_elements=o.bound_elements.add(c.panUp)),c.panDown&&(c.panDown.bind("mousedown.panZoom",eventData,function(t){t.preventDefault(),t.data.target.panZoom("mouseDown","panDown")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(t){t.preventDefault(),t.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(t){t.preventDefault()}),o.bound_elements=o.bound_elements.add(c.panDown)),c.panLeft&&(c.panLeft.bind("mousedown.panZoom",eventData,function(t){t.preventDefault(),t.data.target.panZoom("mouseDown","panLeft")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(t){t.preventDefault(),t.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(t){t.preventDefault()}),o.bound_elements=o.bound_elements.add(c.panLeft)),c.panRight&&(c.panRight.bind("mousedown.panZoom",eventData,function(t){t.preventDefault(),t.data.target.panZoom("mouseDown","panRight")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(t){t.preventDefault(),t.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(t){t.preventDefault()}),o.bound_elements=o.bound_elements.add(c.panRight)),c.fit&&(c.fit.bind("click.panZoom",eventData,function(t){t.preventDefault(),t.data.target.panZoom("fit")}),o.bound_elements=o.bound_elements.add(c.fit)),c.destroy&&(c.destroy.bind("click.panZoom",eventData,function(t){t.preventDefault(),t.data.target.panZoom("destroy")}),o.bound_elements=o.bound_elements.add(c.destroy)),c.double_click&&this.bind("dblclick.panZoom",eventData,function(t){t.data.target.panZoom("zoomIn")}),c.mousewheel&&"function"==typeof this.mousewheel?(this.parent().bind("mousewheel.panZoom",function(o,n){o.preventDefault(),t(this).find("img").panZoom("mouseWheel",n)}),o.bound_elements=o.bound_elements.add(this.parent())):c.mousewheel&&alert("Mousewheel requires jquery-mousewheel by Brandon Aaron (https://github.com/brandonaaron/jquery-mousewheel) - please include it or disable mousewheel to remove this warning."),c.directedit&&(t(c.out_x1).add(c.out_y1).add(c.out_x2).add(c.out_y2).bind("change.panZoom blur.panZoom",eventData,function(t){t.data.target.panZoom("readPosition")}),o.bound_elements=o.bound_elements.add(t(c.out_x1).add(c.out_y1).add(c.out_x2).add(c.out_y2))),c.draggable&&"function"==typeof this.draggable?this.draggable({stop:function(){t(this).panZoom("dragComplete")}}):c.draggable&&alert("Draggable requires jQuery UI - please include jQuery UI or disable draggable to remove this warning."),t(this).bind("load.panZoom",eventData,function(t){t.data.target.panZoom("loadImage")}),o.bound_elements=o.bound_elements.add(this)}function n(){this.data("panZoom",{target_element:this,target_dimensions:{x:null,y:null},viewport_element:this.parent(),viewport_dimensions:{x:this.parent().width(),y:this.parent().height()},position:{x1:null,y1:null,x2:null,y2:null},last_image:null,loaded:!1,mousewheel_delta:0,mousedown_interval:!1,bound_elements:t()}),c.debug&&console.log(this.data("panZoom"))}function i(){"static"==this.parent().css("position")&&this.parent().css("position","relative"),this.css({position:"absolute",top:0,left:0}),c.draggable&&this.css({cursor:"move"})}function a(){var t=this.data("panZoom");if((t.position.x2-t.position.x1<c.min_width/c.factor||t.position.y2-t.position.y1<c.min_height/c.factor)&&(0==t.position.x2||0==t.position.y2?_.fit.apply(this):(t.position.x2-t.position.x1<c.min_width/c.factor&&(t.position.x2=1*t.position.x1+c.min_width/c.factor),t.position.y2-t.position.y1<c.min_height/c.factor&&(t.position.y2=1*t.position.y1+c.min_height/c.factor))),c.aspect){var o=this[0];target=t.target_dimensions.ratio||o.naturalWidth/o.naturalHeight,current=l.apply(this),current>target?(new_width=m.apply(this)*target,diff=u.apply(this)-new_width,t.position.x1=1*t.position.x1+diff/2,t.position.x2=1*t.position.x2-diff/2):target>current&&(new_height=u.apply(this)/target,diff=m.apply(this)-new_height,t.position.y1=1*t.position.y1+diff/2,t.position.y2=1*t.position.y2-diff/2)}}function e(){var t=this.data("panZoom");width=u.apply(this),height=m.apply(this),left_offset=d.apply(this),top_offset=r.apply(this),properties={top:Math.round(top_offset),left:Math.round(left_offset),width:Math.round(width),height:Math.round(height)},t.loaded&&c.animate?s.apply(this,[properties]):p.apply(this,[properties]),c.debug&&(console.log("--"),console.log("width:"+width),console.log("height:"+height),console.log("left:"+left_offset),console.log("top:"+top_offset))}function p(){this.css(properties)}function s(){this.stop().animate(properties,c.animate_duration,c.animate_easing)}function u(){var t=this.data("panZoom");return width=t.position.x2-t.position.x1}function d(){var t=this.data("panZoom");return t.position.x1}function m(){var t=this.data("panZoom");return height=t.position.y2-t.position.y1}function r(){var t=this.data("panZoom");return top_offset=t.position.y1}function l(){return u.apply(this)/m.apply(this)}function h(){var t=this.data("panZoom");c.out_x1&&c.out_x1.val(Math.round(t.position.x1/c.factor)),c.out_y1&&c.out_y1.val(Math.round(t.position.y1/c.factor)),c.out_x2&&c.out_x2.val(Math.round(t.position.x2/c.factor)),c.out_y2&&c.out_y2.val(Math.round(t.position.y2/c.factor))}function f(){var t=this.data("panZoom");return ret={zoom:{x:c.zoom_step/100*t.viewport_dimensions.x,y:c.zoom_step/100*t.viewport_dimensions.y},pan:{x:c.pan_step/100*t.viewport_dimensions.x,y:c.pan_step/100*t.viewport_dimensions.y}}}function y(){var o=this.data("panZoom"),n=document.createElement("img");n.src=this.attr("src"),n.id="jqpz-temp",t("body").append(n),o.target_dimensions.x=t("#jqpz-temp").width(),o.target_dimensions.y=t("#jqpz-temp").height(),t("#jqpz-temp").remove(),o.target_dimensions.ratio=o.target_dimensions.x/o.target_dimensions.y}t.fn.panZoom=function(o){return POSITION_UPDATE="panZoom:position-update",_[o]?_[o].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof o&&o?void t.error("Method "+o+" does not exist"):_.init.apply(this,arguments)},t.fn.panZoom.defaults={zoomIn:!1,zoomOut:!1,panUp:!1,panDown:!1,panLeft:!1,panRight:!1,fit:!1,destroy:!1,out_x1:!1,out_y1:!1,out_x2:!1,out_y2:!1,min_width:20,min_height:20,zoom_step:3,pan_step:3,debug:!1,directedit:!1,aspect:!0,factor:1,animate:!0,animate_duration:200,animate_easing:"linear",double_click:!0,mousewheel:!0,mousewheel_delta:1,draggable:!0,clickandhold:!0};var c={},_={init:function(a){t.extend(c,t.fn.panZoom.defaults,a),i.apply(this),n.apply(this),o.apply(this),_.readPosition.apply(this)},destroy:function(){var t=this.data("panZoom");t.bound_elements.unbind(".panZoom"),c.draggable&&"function"==typeof this.draggable&&this.draggable("destroy"),this.removeData("panZoom")},loadImage:function(){var t=this.data("panZoom");y.apply(this),_.updatePosition.apply(this),null!=t.last_image&&t.last_image!=this.attr("src")&&_.fit.apply(this),t.last_image=this.attr("src"),t.loaded=!0},readPosition:function(){var t=this.data("panZoom");c.out_x1&&(t.position.x1=c.out_x1.val()*c.factor),c.out_y1&&(t.position.y1=c.out_y1.val()*c.factor),c.out_x2&&(t.position.x2=c.out_x2.val()*c.factor),c.out_y2&&(t.position.y2=c.out_y2.val()*c.factor),_.updatePosition.apply(this)},updatePosition:function(){a.apply(this),h.apply(this),e.apply(this),this.trigger(POSITION_UPDATE,this.data("panZoom").position)},fit:function(){var t=this.data("panZoom");t.position.x1=0,t.position.y1=0,t.position.x2=t.viewport_dimensions.x,t.position.y2=t.viewport_dimensions.y,_.updatePosition.apply(this)},zoomIn:function(t){var o=this.data("panZoom");"undefined"==typeof t&&(t=f.apply(this)),o.position.x1=1*o.position.x1-t.zoom.x,o.position.x2=1*o.position.x2+t.zoom.x,o.position.y1=1*o.position.y1-t.zoom.y,o.position.y2=1*o.position.y2+t.zoom.y,_.updatePosition.apply(this)},zoomOut:function(t){var o=this.data("panZoom");"undefined"==typeof t&&(t=f.apply(this)),o.position.x1=1*o.position.x1+t.zoom.x,o.position.x2=1*o.position.x2-t.zoom.x,o.position.y1=1*o.position.y1+t.zoom.y,o.position.y2=1*o.position.y2-t.zoom.y,_.updatePosition.apply(this)},panUp:function(){var t=this.data("panZoom"),o=f.apply(this);t.position.y1-=o.pan.y,t.position.y2-=o.pan.y,_.updatePosition.apply(this)},panDown:function(){var t=this.data("panZoom"),o=f.apply(this);t.position.y1=1*t.position.y1+o.pan.y,t.position.y2=1*t.position.y2+o.pan.y,_.updatePosition.apply(this)},panLeft:function(){var t=this.data("panZoom"),o=f.apply(this);t.position.x1-=o.pan.x,t.position.x2-=o.pan.x,_.updatePosition.apply(this)},panRight:function(){var t=this.data("panZoom"),o=f.apply(this);t.position.x1=1*t.position.x1+o.pan.x,t.position.x2=1*t.position.x2+o.pan.x,_.updatePosition.apply(this)},mouseWheel:function(t){var o=f.apply(this);o.zoom.x=o.zoom.x*(Math.abs(t)/c.mousewheel_delta),o.zoom.y=o.zoom.y*(Math.abs(t)/c.mousewheel_delta),t>0?_.zoomIn.apply(this,[o]):0>t&&_.zoomOut.apply(this,[o])},dragComplete:function(){var t=this.data("panZoom");t.position.x1=this.position().left,t.position.y1=this.position().top,t.position.x2=1*this.position().left+this.width(),t.position.y2=1*this.position().top+this.height(),_.updatePosition.apply(this)},mouseDown:function(t){if(_[t].apply(this),c.clickandhold){var o=this.data("panZoom");_.mouseUp.apply(this),o.mousedown_interval=window.setInterval(function(t,o){t.panZoom(o)},c.animate_duration,this,t)}},mouseUp:function(){var t=this.data("panZoom");window.clearInterval(t.mousedown_interval)}}}(jQuery);

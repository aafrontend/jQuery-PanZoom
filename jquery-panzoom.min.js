(function(n){n.fn.panZoom=function(o){POSITION_UPDATE="panZoom:position-update";if(u[o]){return u[o].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof o==="object"||!o){return u.init.apply(this,arguments)}else{n.error("Method "+o+" does not exist")}};n.fn.panZoom.defaults={zoomIn:false,zoomOut:false,panUp:false,panDown:false,panLeft:false,panRight:false,fit:false,destroy:false,out_x1:false,out_y1:false,out_x2:false,out_y2:false,min_width:20,min_height:20,zoom_step:3,pan_step:3,debug:false,directedit:false,aspect:true,factor:1,animate:true,animate_duration:200,animate_easing:"linear",double_click:true,mousewheel:true,mousewheel_delta:1,draggable:true,clickandhold:true};var s={};var e={};var u={init:function(o){n.extend(s,n.fn.panZoom.defaults,o);a.apply(this);i.apply(this);t.apply(this);u.readPosition.apply(this)},destroy:function(){var o=this.data("panZoom");o.bound_elements.unbind(".panZoom");if(s.draggable&&typeof this.draggable=="function"){this.draggable("destroy")}this.removeData("panZoom")},loadImage:function(){var o=this.data("panZoom");v.apply(this);u.updatePosition.apply(this);if(o.last_image!=null&&o.last_image!=this.attr("src")){u.fit.apply(this)}o.last_image=this.attr("src");o.loaded=true},readPosition:function(){var o=this.data("panZoom");if(s.out_x1){o.position.x1=s.out_x1.val()*s.factor}if(s.out_y1){o.position.y1=s.out_y1.val()*s.factor}if(s.out_x2){o.position.x2=s.out_x2.val()*s.factor}if(s.out_y2){o.position.y2=s.out_y2.val()*s.factor}u.updatePosition.apply(this)},updatePosition:function(){o.apply(this);c.apply(this);p.apply(this);this.trigger(POSITION_UPDATE,this.data("panZoom").position)},fit:function(){var o=this.data("panZoom");o.viewport_dimensions={x:this.parent().width(),y:this.parent().height()};o.position.x1=0;o.position.y1=0;o.position.x2=o.viewport_dimensions.x;o.position.y2=o.viewport_dimensions.y;u.updatePosition.apply(this)},zoomIn:function(o){var t=this.data("panZoom");if(typeof o=="undefined"){o=_.apply(this)}t.position.x1=t.position.x1*1-o.zoom.x;t.position.x2=t.position.x2*1+o.zoom.x;t.position.y1=t.position.y1*1-o.zoom.y;t.position.y2=t.position.y2*1+o.zoom.y;u.updatePosition.apply(this)},zoomOut:function(o){var t=this.data("panZoom");if(typeof o=="undefined"){o=_.apply(this)}t.position.x1=t.position.x1*1+o.zoom.x;t.position.x2=t.position.x2*1-o.zoom.x;t.position.y1=t.position.y1*1+o.zoom.y;t.position.y2=t.position.y2*1-o.zoom.y;u.updatePosition.apply(this)},panUp:function(){var o=this.data("panZoom");var t=_.apply(this);o.position.y1-=t.pan.y;o.position.y2-=t.pan.y;u.updatePosition.apply(this)},panDown:function(){var o=this.data("panZoom");var t=_.apply(this);o.position.y1=o.position.y1*1+t.pan.y;o.position.y2=o.position.y2*1+t.pan.y;u.updatePosition.apply(this)},panLeft:function(){var o=this.data("panZoom");var t=_.apply(this);o.position.x1-=t.pan.x;o.position.x2-=t.pan.x;u.updatePosition.apply(this)},panRight:function(){var o=this.data("panZoom");var t=_.apply(this);o.position.x1=o.position.x1*1+t.pan.x;o.position.x2=o.position.x2*1+t.pan.x;u.updatePosition.apply(this)},mouseWheel:function(o){var t=_.apply(this);t.zoom.x=t.zoom.x*(Math.abs(o)/s.mousewheel_delta);t.zoom.y=t.zoom.y*(Math.abs(o)/s.mousewheel_delta);if(o>0){u.zoomIn.apply(this,[t])}else if(o<0){u.zoomOut.apply(this,[t])}},dragComplete:function(){var o=this.data("panZoom");o.position.x1=this.position().left;o.position.y1=this.position().top;o.position.x2=this.position().left*1+this.width();o.position.y2=this.position().top*1+this.height();u.updatePosition.apply(this)},mouseDown:function(o){u[o].apply(this);if(s.clickandhold){var t=this.data("panZoom");u.mouseUp.apply(this);t.mousedown_interval=window.setInterval(function(o,t){o.panZoom(t)},s.animate_duration,this,o)}},mouseUp:function(){var o=this.data("panZoom");window.clearInterval(o.mousedown_interval)}};function t(){var o={target:this};var t=this.data("panZoom");if(s.zoomIn){s.zoomIn.bind("mousedown.panZoom",o,function(o){o.preventDefault();o.data.target.panZoom("mouseDown","zoomIn")}).bind("mouseleave.panZoom mouseup.panZoom",o,function(o){o.preventDefault();o.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(o){o.preventDefault()});t.bound_elements=t.bound_elements.add(s.zoomIn)}if(s.zoomOut){s.zoomOut.bind("mousedown.panZoom",o,function(o){o.preventDefault();o.data.target.panZoom("mouseDown","zoomOut")}).bind("mouseleave.panZoom mouseup.panZoom",o,function(o){o.preventDefault();o.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(o){o.preventDefault()});t.bound_elements=t.bound_elements.add(s.zoomOut)}if(s.panUp){s.panUp.bind("mousedown.panZoom",o,function(o){o.preventDefault();o.data.target.panZoom("mouseDown","panUp")}).bind("mouseleave.panZoom mouseup.panZoom",o,function(o){o.preventDefault();o.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(o){o.preventDefault()});t.bound_elements=t.bound_elements.add(s.panUp)}if(s.panDown){s.panDown.bind("mousedown.panZoom",o,function(o){o.preventDefault();o.data.target.panZoom("mouseDown","panDown")}).bind("mouseleave.panZoom mouseup.panZoom",o,function(o){o.preventDefault();o.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(o){o.preventDefault()});t.bound_elements=t.bound_elements.add(s.panDown)}if(s.panLeft){s.panLeft.bind("mousedown.panZoom",o,function(o){o.preventDefault();o.data.target.panZoom("mouseDown","panLeft")}).bind("mouseleave.panZoom mouseup.panZoom",o,function(o){o.preventDefault();o.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(o){o.preventDefault()});t.bound_elements=t.bound_elements.add(s.panLeft)}if(s.panRight){s.panRight.bind("mousedown.panZoom",o,function(o){o.preventDefault();o.data.target.panZoom("mouseDown","panRight")}).bind("mouseleave.panZoom mouseup.panZoom",o,function(o){o.preventDefault();o.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(o){o.preventDefault()});t.bound_elements=t.bound_elements.add(s.panRight)}if(s.fit){s.fit.bind("click.panZoom",o,function(o){o.preventDefault();o.data.target.panZoom("fit")});t.bound_elements=t.bound_elements.add(s.fit)}if(s.destroy){s.destroy.bind("click.panZoom",o,function(o){o.preventDefault();o.data.target.panZoom("destroy")});t.bound_elements=t.bound_elements.add(s.destroy)}if(s.double_click){this.bind("dblclick.panZoom",o,function(o){o.data.target.panZoom("zoomIn")})}if(s.mousewheel&&typeof this.mousewheel=="function"){this.parent().bind("mousewheel.panZoom",function(o,t){o.preventDefault();n(this).find("img").panZoom("mouseWheel",t)});t.bound_elements=t.bound_elements.add(this.parent())}else if(s.mousewheel){alert("Mousewheel requires jquery-mousewheel by Brandon Aaron (https://github.com/brandonaaron/jquery-mousewheel) - please include it or disable mousewheel to remove this warning.")}if(s.directedit){n(s.out_x1).add(s.out_y1).add(s.out_x2).add(s.out_y2).bind("change.panZoom blur.panZoom",o,function(o){o.data.target.panZoom("readPosition")});t.bound_elements=t.bound_elements.add(n(s.out_x1).add(s.out_y1).add(s.out_x2).add(s.out_y2))}if(s.draggable&&typeof this.draggable=="function"){this.draggable({stop:function(){n(this).panZoom("dragComplete")}})}else if(s.draggable){alert("Draggable requires jQuery UI - please include jQuery UI or disable draggable to remove this warning.")}n(this).bind("load.panZoom",o,function(o){o.data.target.panZoom("loadImage")});t.bound_elements=t.bound_elements.add(this)}function i(){this.data("panZoom",{target_element:this,target_dimensions:{x:null,y:null},viewport_element:this.parent(),viewport_dimensions:{x:this.parent().width(),y:this.parent().height()},position:{x1:null,y1:null,x2:null,y2:null},last_image:null,loaded:false,mousewheel_delta:0,mousedown_interval:false,bound_elements:n()});if(s.debug){console.log(this.data("panZoom"))}}function a(){if(this.parent().css("position")=="static"){this.parent().css("position","relative")}this.css({position:"absolute",top:0,left:0});if(s.draggable){this.css({cursor:"move"})}}function o(){var o=this.data("panZoom");if(o.position.x2-o.position.x1<s.min_width/s.factor||o.position.y2-o.position.y1<s.min_height/s.factor){if(o.position.x2==0||o.position.y2==0){u.fit.apply(this)}else{if(o.position.x2-o.position.x1<s.min_width/s.factor){o.position.x2=o.position.x1*1+s.min_width/s.factor}if(o.position.y2-o.position.y1<s.min_height/s.factor){o.position.y2=o.position.y1*1+s.min_height/s.factor}}}if(s.aspect){var t=this[0];var n=o.target_dimensions.ratio||t.naturalWidth/t.naturalHeight;var i=y.apply(this);if(i>n){var a=f.apply(this)*n;var e=m.apply(this)-a;o.position.x1=o.position.x1*1+e/2;o.position.x2=o.position.x2*1-e/2}else if(i<n){var p=m.apply(this)/n;e=f.apply(this)-p;o.position.y1=o.position.y1*1+e/2;o.position.y2=o.position.y2*1-e/2}}}function p(){var o=this.data("panZoom");var t=m.apply(this);var n=f.apply(this);var i=r.apply(this);var a=h.apply(this);e={top:Math.round(a),left:Math.round(i),width:Math.round(t),height:Math.round(n)};if(o.loaded&&s.animate){l.apply(this,[e])}else{d.apply(this,[e])}if(s.debug){console.log("--");console.log("width:"+t);console.log("height:"+n);console.log("left:"+i);console.log("top:"+a)}}function d(){this.css(e)}function l(){this.stop().animate(e,s.animate_duration,s.animate_easing)}function m(){var o=this.data("panZoom");var t=o.position.x2-o.position.x1;return t}function r(){var o=this.data("panZoom");return o.position.x1}function f(){var o=this.data("panZoom");var t=o.position.y2-o.position.y1;return t}function h(){var o=this.data("panZoom");var t=o.position.y1;return t}function y(){return m.apply(this)/f.apply(this)}function c(){var o=this.data("panZoom");if(s.out_x1){s.out_x1.val(Math.round(o.position.x1/s.factor))}if(s.out_y1){s.out_y1.val(Math.round(o.position.y1/s.factor))}if(s.out_x2){s.out_x2.val(Math.round(o.position.x2/s.factor))}if(s.out_y2){s.out_y2.val(Math.round(o.position.y2/s.factor))}}function _(){var o=this.data("panZoom");var t={zoom:{x:s.zoom_step/100*o.viewport_dimensions.x,y:s.zoom_step/100*o.viewport_dimensions.y},pan:{x:s.pan_step/100*o.viewport_dimensions.x,y:s.pan_step/100*o.viewport_dimensions.y}};return t}function v(){var o=this.data("panZoom");var t=document.createElement("img");t.src=this.attr("src");t.id="jqpz-temp";n("body").append(t);o.target_dimensions.x=n("#jqpz-temp").width();o.target_dimensions.y=n("#jqpz-temp").height();n("#jqpz-temp").remove();o.target_dimensions.ratio=o.target_dimensions.x/o.target_dimensions.y}})(jQuery);
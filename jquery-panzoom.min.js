/*
 * jQuery PanZoom Plugin
 * Pan and zoom an image within a parent div.
 *
 * version: 0.10.0
 * @requires jQuery v1.4.2 or later (earlier probably work, but untested so far)
 *
 * Copyright (c) 2011 Ben Lumley
 * Examples and documentation at: https://github.com/benlumley/jQuery-PanZoom
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
*/
(function(e){function r(){eventData={target:this};var n=this.data("panZoom");if(t.zoomIn){t.zoomIn.bind("mousedown.panZoom",eventData,function(e){e.preventDefault();e.data.target.panZoom("mouseDown","zoomIn")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(e){e.preventDefault();e.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(e){e.preventDefault()});n.bound_elements=n.bound_elements.add(t.zoomIn)}if(t.zoomOut){t.zoomOut.bind("mousedown.panZoom",eventData,function(e){e.preventDefault();e.data.target.panZoom("mouseDown","zoomOut")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(e){e.preventDefault();e.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(e){e.preventDefault()});n.bound_elements=n.bound_elements.add(t.zoomOut)}if(t.panUp){t.panUp.bind("mousedown.panZoom",eventData,function(e){e.preventDefault();e.data.target.panZoom("mouseDown","panUp")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(e){e.preventDefault();e.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(e){e.preventDefault()});n.bound_elements=n.bound_elements.add(t.panUp)}if(t.panDown){t.panDown.bind("mousedown.panZoom",eventData,function(e){e.preventDefault();e.data.target.panZoom("mouseDown","panDown")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(e){e.preventDefault();e.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(e){e.preventDefault()});n.bound_elements=n.bound_elements.add(t.panDown)}if(t.panLeft){t.panLeft.bind("mousedown.panZoom",eventData,function(e){e.preventDefault();e.data.target.panZoom("mouseDown","panLeft")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(e){e.preventDefault();e.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(e){e.preventDefault()});n.bound_elements=n.bound_elements.add(t.panLeft)}if(t.panRight){t.panRight.bind("mousedown.panZoom",eventData,function(e){e.preventDefault();e.data.target.panZoom("mouseDown","panRight")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(e){e.preventDefault();e.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(e){e.preventDefault()});n.bound_elements=n.bound_elements.add(t.panRight)}if(t.fit){t.fit.bind("click.panZoom",eventData,function(e){e.preventDefault();e.data.target.panZoom("fit")});n.bound_elements=n.bound_elements.add(t.fit)}if(t.destroy){t.destroy.bind("click.panZoom",eventData,function(e){e.preventDefault();e.data.target.panZoom("destroy")});n.bound_elements=n.bound_elements.add(t.destroy)}if(t.double_click){this.bind("dblclick.panZoom",eventData,function(e){e.data.target.panZoom("zoomIn")})}if(t.mousewheel&&typeof this.mousewheel=="function"){this.parent().bind("mousewheel.panZoom",function(t,n){t.preventDefault();e(this).find("img").panZoom("mouseWheel",n)});n.bound_elements=n.bound_elements.add(this.parent())}else if(t.mousewheel){alert("Mousewheel requires jquery-mousewheel by Brandon Aaron (https://github.com/brandonaaron/jquery-mousewheel) - please include it or disable mousewheel to remove this warning.")}if(t.directedit){e(t.out_x1).add(t.out_y1).add(t.out_x2).add(t.out_y2).bind("change.panZoom blur.panZoom",eventData,function(e){e.data.target.panZoom("readPosition")});n.bound_elements=n.bound_elements.add(e(t.out_x1).add(t.out_y1).add(t.out_x2).add(t.out_y2))}if(t.draggable&&typeof this.draggable=="function"){this.draggable({stop:function(){e(this).panZoom("dragComplete")}})}else if(t.draggable){alert("Draggable requires jQuery UI - please include jQuery UI or disable draggable to remove this warning.")}e(this).bind("load.panZoom",eventData,function(e){e.data.target.panZoom("loadImage")});n.bound_elements=n.bound_elements.add(this)}function i(){this.data("panZoom",{target_element:this,target_dimensions:{x:null,y:null},viewport_element:this.parent(),viewport_dimensions:{x:this.parent().width(),y:this.parent().height()},position:{x1:null,y1:null,x2:null,y2:null},last_image:null,loaded:false,mousewheel_delta:0,mousedown_interval:false,bound_elements:e()});if(t.debug){console.log(this.data("panZoom"))}}function s(){if(this.parent().css("position")=="static"){this.parent().css("position","relative")}this.css({position:"absolute",top:0,left:0});if(t.draggable){this.css({cursor:"move"})}}function o(){var e=this.data("panZoom");if(e.position.x2-e.position.x1<t.min_width/t.factor||e.position.y2-e.position.y1<t.min_height/t.factor){if(e.position.x2==0||e.position.y2==0){n.fit.apply(this)}else{if(e.position.x2-e.position.x1<t.min_width/t.factor){e.position.x2=e.position.x1*1+t.min_width/t.factor}if(e.position.y2-e.position.y1<t.min_height/t.factor){e.position.y2=e.position.y1*1+t.min_height/t.factor}}}if(t.aspect){target=e.target_dimensions.ratio;current=d.apply(this);if(current>target){new_width=h.apply(this)*target;diff=l.apply(this)-new_width;e.position.x1=e.position.x1*1+diff/2;e.position.x2=e.position.x2*1-diff/2}else if(current<target){new_height=l.apply(this)/target;diff=h.apply(this)-new_height;e.position.y1=e.position.y1*1+diff/2;e.position.y2=e.position.y2*1-diff/2}}}function u(){var e=this.data("panZoom");width=l.apply(this);height=h.apply(this);left_offset=c.apply(this);top_offset=p.apply(this);properties={top:Math.round(top_offset),left:Math.round(left_offset),width:Math.round(width),height:Math.round(height)};if(e.loaded&&t.animate){f.apply(this,[properties])}else{a.apply(this,[properties])}if(t.debug){console.log("--");console.log("width:"+width);console.log("height:"+height);console.log("left:"+left_offset);console.log("top:"+top_offset)}}function a(){this.css(properties)}function f(){this.stop().animate(properties,t.animate_duration,t.animate_easing)}function l(){var e=this.data("panZoom");width=e.position.x2-e.position.x1;return width}function c(){var e=this.data("panZoom");return e.position.x1}function h(){var e=this.data("panZoom");height=e.position.y2-e.position.y1;return height}function p(){var e=this.data("panZoom");top_offset=e.position.y1;return top_offset}function d(){return l.apply(this)/h.apply(this)}function v(){var e=this.data("panZoom");if(t.out_x1){t.out_x1.val(Math.round(e.position.x1/t.factor))}if(t.out_y1){t.out_y1.val(Math.round(e.position.y1/t.factor))}if(t.out_x2){t.out_x2.val(Math.round(e.position.x2/t.factor))}if(t.out_y2){t.out_y2.val(Math.round(e.position.y2/t.factor))}}function m(){var e=this.data("panZoom");ret={zoom:{x:t.zoom_step/100*e.viewport_dimensions.x,y:t.zoom_step/100*e.viewport_dimensions.y},pan:{x:t.pan_step/100*e.viewport_dimensions.x,y:t.pan_step/100*e.viewport_dimensions.y}};return ret}function g(){var t=this.data("panZoom");var n=document.createElement("img");n.src=this.attr("src");n.id="jqpz-temp";e("body").append(n);t.target_dimensions.x=e("#jqpz-temp").width();t.target_dimensions.y=e("#jqpz-temp").height();e("#jqpz-temp").remove();t.target_dimensions.ratio=t.target_dimensions.x/t.target_dimensions.y}e.fn.panZoom=function(t){POSITION_UPDATE="panZoom:position-update";if(n[t]){return n[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return n.init.apply(this,arguments)}else{e.error("Method "+t+" does not exist")}};e.fn.panZoom.defaults={zoomIn:false,zoomOut:false,panUp:false,panDown:false,panLeft:false,panRight:false,fit:false,destroy:false,out_x1:false,out_y1:false,out_x2:false,out_y2:false,min_width:20,min_height:20,zoom_step:3,pan_step:3,debug:false,directedit:false,aspect:true,factor:1,animate:true,animate_duration:200,animate_easing:"linear",double_click:true,mousewheel:true,mousewheel_delta:1,draggable:true,clickandhold:true};var t={};var n={init:function(o){e.extend(t,e.fn.panZoom.defaults,o);s.apply(this);i.apply(this);r.apply(this);n.readPosition.apply(this)},destroy:function(){var e=this.data("panZoom");e.bound_elements.unbind(".panZoom");if(t.draggable&&typeof this.draggable=="function"){this.draggable("destroy")}this.removeData("panZoom")},loadImage:function(){var e=this.data("panZoom");g.apply(this);n.updatePosition.apply(this);if(e.last_image!=null&&e.last_image!=this.attr("src")){n.fit.apply(this)}e.last_image=this.attr("src");e.loaded=true},readPosition:function(){var e=this.data("panZoom");if(t.out_x1){e.position.x1=t.out_x1.val()*t.factor}if(t.out_y1){e.position.y1=t.out_y1.val()*t.factor}if(t.out_x2){e.position.x2=t.out_x2.val()*t.factor}if(t.out_y2){e.position.y2=t.out_y2.val()*t.factor}n.updatePosition.apply(this)},updatePosition:function(){o.apply(this);v.apply(this);u.apply(this);this.trigger(POSITION_UPDATE,this.data("panZoom").position)},fit:function(){var e=this.data("panZoom");e.position.x1=0;e.position.y1=0;e.position.x2=e.viewport_dimensions.x;e.position.y2=e.viewport_dimensions.y;n.updatePosition.apply(this)},zoomIn:function(e){var t=this.data("panZoom");if(typeof e=="undefined"){e=m.apply(this)}t.position.x1=t.position.x1*1-e.zoom.x;t.position.x2=t.position.x2*1+e.zoom.x;t.position.y1=t.position.y1*1-e.zoom.y;t.position.y2=t.position.y2*1+e.zoom.y;n.updatePosition.apply(this)},zoomOut:function(e){var t=this.data("panZoom");if(typeof e=="undefined"){e=m.apply(this)}t.position.x1=t.position.x1*1+e.zoom.x;t.position.x2=t.position.x2*1-e.zoom.x;t.position.y1=t.position.y1*1+e.zoom.y;t.position.y2=t.position.y2*1-e.zoom.y;n.updatePosition.apply(this)},panUp:function(){var e=this.data("panZoom");var t=m.apply(this);e.position.y1-=t.pan.y;e.position.y2-=t.pan.y;n.updatePosition.apply(this)},panDown:function(){var e=this.data("panZoom");var t=m.apply(this);e.position.y1=e.position.y1*1+t.pan.y;e.position.y2=e.position.y2*1+t.pan.y;n.updatePosition.apply(this)},panLeft:function(){var e=this.data("panZoom");var t=m.apply(this);e.position.x1-=t.pan.x;e.position.x2-=t.pan.x;n.updatePosition.apply(this)},panRight:function(){var e=this.data("panZoom");var t=m.apply(this);e.position.x1=e.position.x1*1+t.pan.x;e.position.x2=e.position.x2*1+t.pan.x;n.updatePosition.apply(this)},mouseWheel:function(e){var r=m.apply(this);r.zoom.x=r.zoom.x*(Math.abs(e)/t.mousewheel_delta);r.zoom.y=r.zoom.y*(Math.abs(e)/t.mousewheel_delta);if(e>0){n.zoomIn.apply(this,[r])}else if(e<0){n.zoomOut.apply(this,[r])}},dragComplete:function(){var e=this.data("panZoom");e.position.x1=this.position().left;e.position.y1=this.position().top;e.position.x2=this.position().left*1+this.width();e.position.y2=this.position().top*1+this.height();n.updatePosition.apply(this)},mouseDown:function(e){n[e].apply(this);if(t.clickandhold){var r=this.data("panZoom");n.mouseUp.apply(this);r.mousedown_interval=window.setInterval(function(e,t){e.panZoom(t)},t.animate_duration,this,e)}},mouseUp:function(){var e=this.data("panZoom");window.clearInterval(e.mousedown_interval)}}})(jQuery)
